DROP SCHEMA IF EXISTS bus_manager;
CREATE SCHEMA bus_manager CHARACTER SET utf8;
USE bus_manager;

CREATE TABLE IF NOT EXISTS DRIVER(
    DRIVER_ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL UNIQUE,
    PHONE_NUMBER varchar(20),
    LICENCE_EXPIRE DATE,
    DRIVER_NAME varchar(30) NOT NULL,
    DRIVER_SURNAME varchar(30) NOT NULL
);

CREATE TABLE IF NOT EXISTS USER(
    USER_ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL UNIQUE,
    USERNAME VARCHAR(32) NOT NULL UNIQUE,
    PASSWORD VARCHAR(32) NOT NULL,
    ROLE ENUM('ADMIN','MANAGER', 'PASSENGER') NOT NULL
);


CREATE TABLE IF NOT EXISTS BUS(
    BUS_ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL,
    REGISTRATION_NUMBER varchar(10) NOT NULL UNIQUE,
    LAST_TI DATE,
    NEXT_TI DATE,
    BUS_MODEL VARCHAR(100) NOT NULL);

CREATE TABLE IF NOT EXISTS JOURNEY(
    JOURNEY_ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL,
    DRIVER_ID INTEGER,
    BUS_ID INTEGER,
    LEAVING_DATE DATE,
    ARRIVING_DATE DATE,
    FROM_PLACE VARCHAR(100),
    DESTINATION VARCHAR(100),
    constraint journey_fk_1 foreign key (DRIVER_ID) references DRIVER(DRIVER_ID) ON DELETE set null ON UPDATE NO ACTION,
    constraint journey_fk_2 foreign key (BUS_ID) references BUS(BUS_ID) ON DELETE set null ON UPDATE NO ACTION
);

CREATE TABLE IF NOT EXISTS PASSENGER (
    PASSENGER_ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL UNIQUE,
    PASSENGER_NAME varchar(20) NOT NULL,
    PASSENGER_SURNAME varchar(20) NOT NULL,
    PHONE_NUMBER varchar(20),
    USER_ID INTEGER,
    CONSTRAINT passenger_fk FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS JOURNEYS_PASSENGERS(
    ID INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL UNIQUE,
    PASSENGER_ID INTEGER,
    JOURNEY_ID INTEGER,
    constraint jc_fk_1 foreign key (PASSENGER_ID) references PASSENGER(PASSENGER_ID) ON DELETE SET NULL ON UPDATE NO ACTION,
    constraint jc_fk_2 foreign key (JOURNEY_ID) references JOURNEY(JOURNEY_ID) ON DELETE SET NULL ON UPDATE NO ACTION
);

